BveTs Map 2.02

// 駅の停止位置を設置する。また、次の地上子を設置する。
//  - 0 メートル地点付近に設置する、TASC 停止位置設定地上子
//  - この駅の停止位置 11 メートル手前の位置合わせ用地上子
//  - 一つ後の駅の停止位置 500 メートル手前の停車駅予告地上子
//  - この駅用の発車合図タイミング設定地上子
// このファイルを include する前に以下の変数を設定しておく必要がある。
//  $location = 停止位置 (整数が望ましい)
//  $preceding_station_number = 設置する駅の番号 (始発駅は 0)
//  $following_station_location = 一つ後の駅の停止位置
//  $station_abs_beacon_type = TASC 停止位置設定地上子の番号
//  $station_500m_beacon_type = 停止位置 500 メートル手前に置く地上子の番号
//  $station_11m_beacon_type = 停止位置 11 メートル手前に置く地上子の番号
//  $conductor_timing_beacon_type = 発車合図タイミングを設定する地上子の番号
//  $_door_direction = ドアが開く方向
//  $_underrun_limit = 許容されるアンダーラン距離
//  $_overrun_limit = 許容されるオーバーラン距離
// このファイルの中で以下の変数が変更される。
//  $preceding_station_number = 次に設置する (一つ手前の) 駅の番号
//  $following_station_location = 今回設置した駅の停止位置 (= $location)

$location;
	Station['station_' + $preceding_station_number].Put($_door_direction, -$_underrun_limit, $_overrun_limit);
	$preceding_station_number = $preceding_station_number - 1;

// 0 メートル地点付近に TASC 地上子を置く。
// 地上子の順序が駅の順序と一致するように、地上子を一駅ごとに 1 メートルずらす。
$preceding_station_number;
	Beacon.Put($station_abs_beacon_type, 0, $location);

// 一つ後の駅の 500 メートル手前に駅停車予告地上子を置く。
// 駅が近いときは 500 メートルよりも近い位置に設置することになる。
	$__l = $location + 10;
$following_station_location - 500;
(distance + $__l + abs(distance - $__l)) / 2; // max(distance, $__l)
	Beacon.Put($station_500m_beacon_type, -1, 0);

// 11 メートル手前に位置合わせ地上子を置く
$location - 11;
	Beacon.Put($station_11m_beacon_type, -1, 11000);

// 発車合図タイミング設定地上子も置く
$location - 11;
	Beacon.Put($conductor_timing_beacon_type, -1, floor(abs(rand(8) - 3) + 0.5));

$following_station_location = $location;
